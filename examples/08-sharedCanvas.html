<style>
  canvas { border: solid; display: block; }
</style>
<body>
  <div id="user"></div>
  <canvas id="localCanvas" width="500" height="500"></canvas>
  <canvas id="echoCanvas" width="500" height="500"></canvas>
  <script>
    ws = new WebSocket('ws://138.197.24.38:8080');
    
    ws.onmessage = m => {
      var i = new Image();
      i.onload = _ => {
        echoContext.clearRect(0, 0, echoCanvas.width, echoCanvas.height);
        echoContext.drawImage(i, 0, 0);
      }
      i.src = m.data;
    }

    echoContext = echoCanvas.getContext('2d');
    localContext = localCanvas.getContext('2d');
    localContext.strokeStyle = prompt("What's your favorite color?");
    newStuff = false;
    localCanvas.onmousedown = e => {
      localContext.moveTo(e.offsetX, e.offsetY)
    }
    
    localCanvas.onmousemove = e => {
      if (e.buttons) {
        newStuff = true;
        localContext.clearRect(0, 0, localCanvas.width, localCanvas.height);
        localContext.lineTo(e.offsetX, e.offsetY);
        localContext.stroke();
      }
    }

    setInterval(send, 250);
    
    function send() {
      if (!newStuff) return;
      ws.send(localCanvas.toDataURL());
      newStuff = false;
    }
  </script>
</body>